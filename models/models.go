package models

import (
	"time"

	"github.com/jinzhu/gorm"
)

// CveDetail is a parent of Jnv/Nvd model
type CveDetail struct {
	gorm.Model `json:"-" xml:"-"`
	CveInfoID  uint `json:"-" xml:"-"`

	CveID string
	Nvd   Nvd
	Jvn   Jvn
}

// Nvd is a model of NVD
type Nvd struct {
	gorm.Model  `json:"-" xml:"-"`
	CveDetailID uint `json:"-" xml:"-"`

	CveID string

	// Increased size of summary to ensure we can fit arbitrary CVE content.
	Summary string `gorm:"size:4096"`

	Score                 float64 // 1 to 10
	AccessVector          string
	AccessComplexity      string
	Authentication        string
	ConfidentialityImpact string
	IntegrityImpact       string
	AvailabilityImpact    string

	Cpes       []Cpe
	CweID      string
	References []Reference

	PublishedDate    time.Time
	LastModifiedDate time.Time
}

// Jvn is a model of JVN
type Jvn struct {
	gorm.Model  `json:"-" xml:"-"`
	CveDetailID uint `json:"-" xml:"-"`

	CveID   string
	Title   string
	Summary string `gorm:"size:8192"`
	JvnLink string
	JvnID   string

	Score    float64 // 1 to 10
	Severity string  // Low|Medium|High
	Vector   string  // (AV:N/AC:M/Au:N/C:N/I:P/A:N)
	//  Version   string  // 2.0

	Cpes       []Cpe
	References []Reference

	PublishedDate    time.Time
	LastModifiedDate time.Time
}

// Cpe is Child model of Jvn/Nvd.
// see https://www.ipa.go.jp/security/vuln/CPE.html
type Cpe struct {
	gorm.Model `json:"-" xml:"-"`
	JvnID      uint `json:"-" xml:"-"`
	NvdID      uint `json:"-" xml:"-"`

	// CPE Name (URL style)
	// JVN ... cpe:/a:oracle:mysql
	// NVD ... cpe:/a:cisco:unified_contact_center_express:11.0%281%29
	CpeName string
	//TODO Cpe22URI
	//TODO Cpe23URI

	// each items
	Part         string
	Vendor       string
	Product      string
	Version      string
	VendorUpdate string
	Edition      string
	Language     string
}

// Reference is Child model of Jvn/Nvd.
// It holds reference information about the CVE.
type Reference struct {
	gorm.Model `json:"-" xml:"-"`
	JvnID      uint `json:"-" xml:"-"`
	NvdID      uint `json:"-" xml:"-"`

	Source string
	Link   string `gorm:"size:512"`
}
